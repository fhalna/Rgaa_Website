AddDefaultCharset utf-8
DefaultLanguage fr-FR

# Prevent directory browsing
<IfModule mod_autoindex.c>
	Options -Indexes
</IfModule>

# Prevent robots.txt file indexing
<Files ~ "robots\.txt$">
	Header set X-Robots-Tag "noindex"
</Files>

# Prevent sitemap.xml file indexing
<Files ~ "sitemap\.xml$">
	Header set X-Robots-Tag "noindex"
</Files>

# Block access to internal directories
<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteRule ^includes/ - [F,L]
	RewriteRule ^lang/ - [F,L]
	RewriteRule ^less/ - [F,L]
	RewriteRule ^scripts/ - [F,L]
	RewriteRule ^tests/ - [F,L]
	RewriteRule ^data/ - [F,L]
	RewriteRule ^mcp-server/ - [F,L]
	RewriteRule ^node_modules/ - [F,L]
</IfModule>

# Add file types
AddType x-font/otf .otf
AddType x-font/ttf .ttf
AddType x-font/eot .eot
AddType x-font/woff .woff
AddType x-font/woff2 .woff2
AddType text/javascript .js

# Gzip compression
<IfModule mod_deflate.c>
	AddOutputFilterByType DEFLATE image/svg+xml
	AddOutputFilterByType DEFLATE x-font/ttf
	AddOutputFilterByType DEFLATE x-font/otf
	AddOutputFilterByType DEFLATE x-font/eot
	AddOutputFilterByType DEFLATE text/html
	AddOutputFilterByType DEFLATE application/javascript
	AddOutputFilterByType DEFLATE text/css
	AddOutputFilterByType DEFLATE application/pdf
</IfModule>

# Browser caching
<IfModule mod_expires.c>
	ExpiresActive On
	ExpiresDefault "now plus 1 week"

	ExpiresByType image/gif "now plus 1 year"
	ExpiresByType image/jpeg "now plus 1 year"
	ExpiresByType image/png "now plus 1 year"
	ExpiresByType text/css "now plus 1 month"
	ExpiresByType text/javascript "now plus 1 month"
	ExpiresByType application/javascript "now plus 1 month"
	ExpiresByType image/svg+xml "now plus 1 year"
	ExpiresByType x-font/otf "now plus 1 year"
	ExpiresByType x-font/ttf "now plus 1 year"
	ExpiresByType x-font/eot "now plus 1 year"
	ExpiresByType x-font/woff "now plus 1 year"
	ExpiresByType x-font/woff2 "now plus 1 year"
	ExpiresByType image/x-icon "now plus 1 year"
</IfModule>

# Security headers
<IfModule mod_headers.c>
	Header always set X-Content-Type-Options "nosniff"
	Header always set X-XSS-Protection "1; mode=block"
	Header always set X-FRAME-OPTIONS "SAMEORIGIN"
	Header set Content-Security-Policy "default-src 'self'; script-src 'self' https://matomo.tanaguru.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self'; frame-src https://matomo.tanaguru.com; base-uri 'self';"
</IfModule>

# Error pages
ErrorDocument 404 /404.html
ErrorDocument 403 /403.html

# PHP default index
DirectoryIndex index.php index.html

# Redirections
<IfModule mod_rewrite.c>
	Options +FollowSymLinks
	RewriteEngine On
	RewriteBase /

	# Redirect old .html URLs to .php (backward compatibility)
	# Only for files that have a .php equivalent
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} \.html$
	RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_URI} !-f
	RewriteRule ^(.+)\.html$ /$1.php [R=301,L]

	# French legacy URLs
	Redirect 301 /fr/ https://rgaa.tanaguru.com/

	# RGAA 4.1 legacy paths
	Redirect 301 /rgaa4-1/base.html https://rgaa.tanaguru.com/rgaa4-1-base.php
	Redirect 301 /rgaa4-1/cas-particuliers.html https://rgaa.tanaguru.com/index.php
	Redirect 301 /rgaa4-1/criteres.html https://rgaa.tanaguru.com/index.php
	Redirect 301 /rgaa4-1/glossaire.html https://rgaa.tanaguru.com/rgaa4-1-glossaire.php
	Redirect 301 /rgaa4-1/notes-techniques.html https://rgaa.tanaguru.com/index.php
	Redirect 301 /rgaa4-1/references.html https://rgaa.tanaguru.com/rgaa4-1-references.php
	Redirect 301 /rgaa4-1/mentions.html https://rgaa.tanaguru.com/mentions.php

	# RGAA 4.0 legacy paths
	Redirect 301 /rgaa4/base.html https://rgaa.tanaguru.com/rgaa4-base.php
	Redirect 301 /rgaa4/cas-particuliers.html https://rgaa.tanaguru.com/rgaa4-criteres.php
	Redirect 301 /rgaa4/criteres.html https://rgaa.tanaguru.com/rgaa4-criteres.php
	Redirect 301 /rgaa4/glossaire.html https://rgaa.tanaguru.com/rgaa4-glossaire.php
	Redirect 301 /rgaa4/notes-techniques.html https://rgaa.tanaguru.com/rgaa4-criteres.php
	Redirect 301 /rgaa4/references.html https://rgaa.tanaguru.com/rgaa4-references.php
	Redirect 301 /rgaa4/mentions.html https://rgaa.tanaguru.com/mentions.php

	# RGAA 3 legacy paths
	Redirect 301 /rgaa3/base.html https://rgaa.tanaguru.com/rgaa3-base.php
	Redirect 301 /rgaa3/cas-particuliers.html https://rgaa.tanaguru.com/rgaa3-cas-particuliers.php
	Redirect 301 /rgaa3/criteres.html https://rgaa.tanaguru.com/rgaa3-criteres.php
	Redirect 301 /rgaa3/glossaire.html https://rgaa.tanaguru.com/rgaa3-glossaire.php
	Redirect 301 /rgaa3/notes-techniques.html https://rgaa.tanaguru.com/rgaa3-notes-techniques.php
	Redirect 301 /rgaa3/references.html https://rgaa.tanaguru.com/rgaa3-references.php
	Redirect 301 /rgaa3/mentions.html https://rgaa.tanaguru.com/mentions.php

	# Very old root-level legacy paths
	Redirect 301 /base.html https://rgaa.tanaguru.com/rgaa3-base.php
	Redirect 301 /base-de-reference.html https://rgaa.tanaguru.com/rgaa3-base.php
	Redirect 301 /cas-particuliers.html https://rgaa.tanaguru.com/rgaa3-cas-particuliers.php
	Redirect 301 /criteres.html https://rgaa.tanaguru.com/rgaa3-criteres.php
	Redirect 301 /glossaire.html https://rgaa.tanaguru.com/rgaa3-glossaire.php
	Redirect 301 /notes-techniques.html https://rgaa.tanaguru.com/rgaa3-notes-techniques.php
	Redirect 301 /references.html https://rgaa.tanaguru.com/rgaa3-references.php

	# English legacy paths
	Redirect 301 /en/rgaa3/base.html https://rgaa.tanaguru.com/en/rgaa3-baseline.php
	Redirect 301 /en/rgaa3/cas-particuliers.html https://rgaa.tanaguru.com/en/rgaa3-particular-cases.php
	Redirect 301 /en/rgaa3/criteres.html https://rgaa.tanaguru.com/en/rgaa3-criteria.php
	Redirect 301 /en/rgaa3/glossaire.html https://rgaa.tanaguru.com/en/rgaa3-glossary.php
	Redirect 301 /en/rgaa3/notes-techniques.html https://rgaa.tanaguru.com/en/rgaa3-technical-notes.php
	Redirect 301 /en/rgaa3/references.html https://rgaa.tanaguru.com/en/rgaa3-references.php
	Redirect 301 /en/rgaa3/mentions.html https://rgaa.tanaguru.com/en/legal-notice.php

	Redirect 301 /en/base.html https://rgaa.tanaguru.com/en/rgaa3-baseline.php
	Redirect 301 /en/baseline.html https://rgaa.tanaguru.com/en/rgaa3-baseline.php
	Redirect 301 /en/cas-particuliers.html https://rgaa.tanaguru.com/en/rgaa3-particular-cases.php
	Redirect 301 /en/criteres.html https://rgaa.tanaguru.com/en/rgaa3-criteria.php
	Redirect 301 /en/criteria.html https://rgaa.tanaguru.com/en/rgaa3-criteria.php
	Redirect 301 /en/glossaire.html https://rgaa.tanaguru.com/en/rgaa3-glossary.php
	Redirect 301 /en/notes-techniques.html https://rgaa.tanaguru.com/en/rgaa3-technical-notes.php
	Redirect 301 /en/references.html https://rgaa.tanaguru.com/en/rgaa3-references.php
	Redirect 301 /en/mentions.html https://rgaa.tanaguru.com/en/legal-notice.php

	Redirect 301 /rgaa3-particular-cases.html https://rgaa.tanaguru.com/en/rgaa3-particular-cases.php
	Redirect 301 /RGAA3.0_Criteria_English_version_v1.html https://rgaa.tanaguru.com/en/rgaa3-criteria.php
</IfModule>
